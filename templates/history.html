{% extends "base.html" %} {% load custom_filters %} {% block title %}L·ªãch S·ª≠ D·ª±
ƒêo√°n{% endblock %} {% block extra_css %}
<style>
  .history-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .history-header h2 {
    color: #10b981;
    font-size: 28px;
    margin-bottom: 10px;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .stat-card::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 10px,
      rgba(255, 255, 255, 0.05) 10px,
      rgba(255, 255, 255, 0.05) 20px
    );
  }

  .stat-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 12px 35px rgba(16, 185, 129, 0.5);
  }

  .stat-card .number {
    font-size: 42px;
    font-weight: bold;
    margin-bottom: 8px;
    position: relative;
    z-index: 1;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  .stat-card .label {
    font-size: 14px;
    opacity: 0.95;
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
  }

  .table-container {
    overflow-x: auto;
    margin-top: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  th,
  td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  th {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    font-weight: 600;
    position: sticky;
    top: 0;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    padding: 15px 12px;
  }

  tr:hover {
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.05) 0%,
      rgba(5, 150, 105, 0.05) 100%
    );
    transform: scale(1.01);
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
  }

  .decision-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: bold;
    border: none;
  }

  .badge-approved {
    background: #10b981 !important;
    color: white !important;
    border: 2px solid #059669;
  }

  .badge-conditional {
    background: #fbbf24 !important;
    color: white !important;
    border: 2px solid #f59e0b;
  }

  .badge-rejected {
    background: #ef4444 !important;
    color: white !important;
    border: 2px solid #dc2626;
  }

  .risk-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: bold;
    border: none;
  }

  .risk-low {
    background: #10b981 !important;
    color: white !important;
    border: 2px solid #059669;
  }

  .risk-medium {
    background: #fbbf24 !important;
    color: white !important;
    border: 2px solid #f59e0b;
  }

  .risk-high {
    background: #ef4444 !important;
    color: white !important;
    border: 2px solid #dc2626;
  }

  .empty-state {
    text-align: center;
    padding: 80px 20px;
    color: #666;
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.9);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .empty-state .icon {
    font-size: 72px;
    margin-bottom: 20px;
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-10px);
    }
  }

  .empty-state p {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .explanation-cell {
    max-width: 300px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    cursor: help;
    position: relative;
  }

  .explanation-cell:hover {
    white-space: normal;
    overflow: visible;
  }

  .explanation-full {
    font-size: 12px;
    color: #666;
    line-height: 1.4;
  }
</style>
{% endblock %} {% block content %}
<div class="history-header">
  <h2>üìä L·ªãch S·ª≠ D·ª± ƒêo√°n</h2>
  <p>T·ªïng h·ª£p c√°c ƒë√°nh gi√° r·ªßi ro t√≠n d·ª•ng ƒë√£ th·ª±c hi·ªán</p>
</div>

{% if predictions %}
<div class="stats-grid">
  <div class="stat-card">
    <div class="number">{{ total_predictions }}</div>
    <div class="label">T·ªïng ƒê√°nh Gi√°</div>
  </div>
  <div class="stat-card">
    <div class="number">{{ approved_count }}</div>
    <div class="label">ƒê√£ Duy·ªát</div>
  </div>
  <div class="stat-card">
    <div class="number">{{ conditional_count }}</div>
    <div class="label">Duy·ªát C√≥ ƒêi·ªÅu Ki·ªán</div>
  </div>
  <div class="stat-card">
    <div class="number">{{ rejected_count }}</div>
    <div class="label">T·ª´ Ch·ªëi</div>
  </div>
  <div class="stat-card">
    <div class="number">{{ avg_probability|floatformat:1 }}%</div>
    <div class="label">TB X√°c Su·∫•t V·ª° N·ª£</div>
  </div>
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th>Th·ªùi Gian</th>
        <th>Thu Nh·∫≠p</th>
        <th>S·ªë Ti·ªÅn Vay</th>
        <th>X√°c Su·∫•t V·ª° N·ª£</th>
        <th>ƒêi·ªÉm AHP</th>
        <th>M·ª©c R·ªßi Ro</th>
        <th>Quy·∫øt ƒê·ªãnh</th>
        <th>H·∫°n M·ª©c G·ª£i √ù</th>
        <th>L√Ω Do</th>
      </tr>
    </thead>
    <tbody>
      {% for pred in predictions %}
      <tr class="{% if pred.decision == 'Duy·ªát' %}table-success{% endif %}">
        <td>{{ pred.created_at|date:"d/m/Y H:i" }}</td>
        <td>{{ pred.person_income|format_number }}</td>
        <td>{{ pred.loan_amnt|format_number }}</td>
        <td>{{ pred.probability_default|floatformat:2 }}%</td>
        <td>{{ pred.ahp_score|floatformat:4 }}</td>
        <td>
          {% if pred.risk_level == "R·ªßi ro th·∫•p" %}
          <span class="risk-badge risk-low">{{ pred.risk_level }}</span>
          {% elif pred.risk_level == "R·ªßi ro trung b√¨nh" %}
          <span class="risk-badge risk-medium">{{ pred.risk_level }}</span>
          {% else %}
          <span class="risk-badge risk-high">{{ pred.risk_level }}</span>
          {% endif %}
        </td>
        <td>
          {% if pred.decision == "DUY·ªÜT" %}
          <span class="decision-badge badge-approved"
            ><i class="fas fa-check-circle"></i> {{ pred.decision }}</span
          >
          {% elif pred.decision == "DUY·ªÜT C√ì ƒêI·ªÄU KI·ªÜN" %}
          <span class="decision-badge badge-conditional"
            ><i class="fas fa-exclamation-triangle"></i> {{ pred.decision
            }}</span
          >
          {% else %}
          <span class="decision-badge badge-rejected"
            ><i class="fas fa-times-circle"></i> {{ pred.decision }}</span
          >
          {% endif %}
        </td>
        <td>{{ pred.recommended_amount|format_number }}</td>
        <td class="explanation-cell">
          <div class="explanation-full">{{ pred.explanation }}</div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="empty-state">
  <div class="icon">üì≠</div>
  <p>Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√°nh gi√° n√†o</p>
  <a href="{% url 'credit_app:index' %}" class="btn"
    >Th·ª±c Hi·ªán ƒê√°nh Gi√° ƒê·∫ßu Ti√™n</a
  >
</div>
{% endif %} {% endblock %}
